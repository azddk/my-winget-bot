jobs:
  winget-update:
    runs-on: windows-latest
    steps:
      - name: Install WingetCreate
        run: |
          Invoke-WebRequest -Uri https://aka.ms/wingetcreate/latest -OutFile wingetcreate.exe
      
      - name: Run Winget Update
        env:
          GITHUB_TOKEN: ${{ secrets.WINGET_TOKEN }}
        run: |
          # We append |exe to force the type to 'exe' instead of letting it auto-detect 'Burn'
          # This matches the existing manifest strictly and usually fixes the 'Multiple matches' error.
          $urlComplex = "${{ inputs.installerUrl }}|${{ inputs.architecture }}|${{ inputs.scope }}|exe"
          
          Write-Host "Processing: $urlComplex"
          
          .\wingetcreate.exe update "${{ inputs.packageId }}" `
            --version "${{ inputs.version }}" `
            --urls "$urlComplex" `
            --token "${{ env.GITHUB_TOKEN }}" `
            --submit
